(()=>{"use strict";function e(e,t){const r=function(){const e=(()=>{const e=new Array(10);for(let t=0;t<10;t++){e[t]={};for(let r=0;r<10;r++)e[t][r]={hit:!1,shipId:null}}return e})(),t=[],r=(t,r)=>null!==e[t][r].shipId,o=()=>t.filter((e=>!1===e.isSunk())).length;return{tiles:e,ships:t,placeShip:(r,[o,s],n)=>{const a=(e=>{let r;switch(e){case 5:r=0;break;case 4:r=1;break;case 2:r=4;break;case 3:r=t.some((e=>2===e.id))?3:2}return r})(r),c=function(e,t){const r=[...Array(t).keys()].reduce(((e,t)=>(e[t]=!1,e)),{});return{id:e,length:t,health:r,coords:[],hit:e=>{r[e]=!0},isSunk:()=>Object.values(r).every((e=>!0===e))}}(a,r);if(t.push(c),"x"===n)for(let t=0;t<c.length;t++)c.coords.push([o,s]),e[o][s].shipId=c.id,o+=1;if("y"===n)for(let t=0;t<c.length;t++)c.coords.push([o,s]),e[o][s].shipId=c.id,s+=1},hasShip:r,receiveAttack:o=>{const[s,n]=o,a=e[s][n];if(!a.hit){if(r(s,n)){const e=(e=>{let r;for(let o=0;o<t.length;o++)t[o].id===e&&(r=t[o]);return r})(a.shipId);for(let t=0;t<e.coords.length;t++)e.coords[t].every(((e,t)=>e===o[t]))&&(e.health[t]=!0)}a.hit=!0}},shipsRemaining:o,allShipsSunk:()=>0===o(),removeLastShip:()=>{const[r]=t.splice(t.length-1,1);for(let t=0;t<r.coords.length;t++){const[o,s]=r.coords[t];e[o][s].shipId=null}}}}(),o=[];return{get num(){return e},get board(){return r},get isHuman(){return t},get moves(){return o},makeMove:(e,t)=>{t.receiveAttack(e),o.push(e)}}}const t=document.querySelectorAll(".board"),r=document.querySelector("#player-board"),o=document.querySelector("#com-board"),s=document.querySelector("#game-info"),n=e=>{const t=(e.isHuman?r:o).previousElementSibling,s=e.board.shipsRemaining();t.textContent=`Ships remaining: ${s}`},a=e=>{const t=document.querySelectorAll(".ship-counter");e?t.forEach((e=>e.classList.add("opacity-0"))):t.forEach((e=>e.classList.remove("opacity-0")))},c=e=>{const t=e.isHuman?r:o,{ships:s}=e.board;Object.keys(s).forEach((e=>{const r=s[e],{id:o}=r,{coords:n}=r;for(let e=0;e<n.length;e++){const[r,s]=n[e],a=t.querySelector(`[data-x='${r}'][data-y='${s}']`);a.classList.add("ship"),a.dataset.shipId=o}})),n(e)},l=e=>{const t=e.isHuman?r:o,{board:s}=e,{tiles:a}=s;for(let e=0;e<a.length;e++)for(let r=0;r<Object.keys(a[e]).length;r++){const o=a[e][r],n=s.hasShip(e,r);if(o.hit){const o=t.querySelector(`[data-x='${e}'][data-y='${r}']`);n?o.classList.add("hit"):o.classList.add("miss")}}n(e)},i=e=>{e?t.forEach((e=>e.classList.add("game-over"))):t.forEach((e=>e.classList.remove("game-over")))},d=(...e)=>{t.forEach((e=>{e.querySelectorAll(".board-cell").forEach((e=>{e.classList.remove("miss","hit","ship"),e.removeAttribute("data-ship-id")}))})),e.forEach((e=>n(e))),i(!1)},u=(e,t)=>{const r={setup:`Board setup ... ${5-t} ship(s) to place`,ready:"Game ready to start",p1Turn:"Player's turn",comTurn:"thinking ..."};s.textContent=r[e]},h=(e,t)=>{const s="com"===t?o:r;e?s.classList.add("no-events"):s.classList.remove("no-events")},p=e=>{const t=document.querySelector("#start-btn");e?t.setAttribute("disabled",""):t.removeAttribute("disabled")},m=e=>{5===e?(p(!1),u("ready")):(p(!0),u("setup",e))},f=e=>{const t=document.querySelectorAll(".board-funcs"),r=document.querySelector("#player-buttons");e?(t.forEach((e=>e.setAttribute("disabled",""))),r.classList.add("opacity-0")):(t.forEach((e=>e.removeAttribute("disabled"))),r.classList.remove("opacity-0"))},y=e=>[Number(e.dataset.x),Number(e.dataset.y)],b=(e,t)=>{const r=e.moves;for(let e=0;e<r.length;e++)if(r[e].every(((e,r)=>e===t[r])))return!0;return!1},v=()=>[Math.floor(10*Math.random()),Math.floor(10*Math.random())],S=e=>{const t=(e=>{const{board:t}=e,{tiles:r}=t,o=[];for(let e=0;e<r.length;e++)for(let s=0;s<Object.keys(r[e]).length;s++)if(!t.hasShip(e,s)){const t=[e,s];o.push(t)}return o})(e);return t[Math.floor(Math.random()*t.length)]},g=e=>{switch(e){case 0:return 5;case 1:return 4;case 2:case 3:return 3;case 4:return 2;default:return null}},L=document.querySelector("#player-board"),E={x:!0,y:!1},k=()=>Object.keys(E).filter((e=>!0===E[e]))[0],q=()=>{E.x=!E.x,E.y=!E.x},x=(e,t,r)=>{const[o,s]=e,n=[];if("x"===t)for(let e=0;e<r;e++)n.push([e+o,s]);if("y"===t)for(let e=0;e<r;e++)n.push([o,e+s]);return n},A=(e,t,r)=>{const[o,s]=r;return"x"===t?o+e-1<=9:"y"===t&&s+e-1<=9},M=(e,t)=>{const{board:r}=t;for(let t=0;t<e.length;t++){const[o,s]=e[t];if(!0===r.hasShip(o,s))return!1}return!0},w=()=>{L.querySelectorAll(".board-cell").forEach((e=>e.classList.remove("ship-preview","invalid")))},$=(e,t)=>{let r,o,s=!1;for(;!s;){const n=S(e),a=["x","y"][Math.floor(2*Math.random())];s=A(t,a,n),r=n,o=a}return[r,o]},I=(e,t)=>{let r,o,s=!1;for(;!s;){const[n,a]=$(e,t),c=x(n,a,t);s=M(c,e),r=n,o=a}return[r,o]},C=(e,t=0)=>{const r=[5,4,3,3,2];for(let o=t;o<r.length;o++){const t=r[o],s=I(e,t);e.board.placeShip(t,...s)}},T={p1:null,com:null},j=e=>e.board.allShipsSunk(),O=()=>{T.p1=e(1,!0),T.com=e(2,!1),d(T.p1,T.com),p(!0),h(!0,"com"),h(!1,"player"),f(!1),u("setup",T.p1.board.ships.length),a(!0)},H=()=>{C(T.com),p(!0),l(T.com),h(!0,"player"),h(!1,"com"),f(!0),u("p1Turn"),a(!1)},G=e=>{h(!0,"com"),(e=>{const t=1===e.num?"Congratulations! You win!":"Game over ... Computer wins!";s.textContent=t,i(!0)})(e)},N=e=>{const{p1:t,com:r}=T;b(t,e)||(t.makeMove(e,r.board),l(r),j(r)?G(t):((async()=>{const{p1:e,com:t}=T,r=await(async e=>{let t=v();for(;b(e,t);)t=v();return await new Promise((e=>{setTimeout(e,400)})),t})(t);t.makeMove(r,e.board),l(e),j(e)?G(t):(h(!1,"com"),u("p1Turn"))})(),u("comTurn")),h(!0,"com"))},P=()=>T.p1.board.ships.length,R=e=>{const{p1:t}=T,r=P();if(e.target.classList.contains("board")||r>=5)return;const o=y(e.target),s=g(r),n=k(),a=((e,t,r,o)=>{if(A(o,r,t)){const s=x(t,r,o);if(M(s,e))return!0}return!1})(t,o,n,s);if(a){t.board.placeShip(s,o,n),w(),c(t);const e=P();m(e)}},B=()=>{const{p1:e}=T;0!==e.board.ships.length&&(e.board.removeLastShip(),d(e),c(e),m(P()))},Y=()=>{const{p1:e}=T,t=P();if(C(e,t),c(e),m(P()),5===t){for(let e=0;e<5;e++)B();Y()}};t.forEach((e=>{for(let t=0;t<10;t++)for(let r=0;r<10;r++){const o=document.createElement("div");o.classList.add("board-cell"),o.dataset.x=r,o.dataset.y=t,e.appendChild(o)}})),O(),document.querySelectorAll("#com-board .board-cell").forEach((e=>{e.addEventListener("click",(e=>{const t=y(e.target);N(t)}))})),document.querySelector("#restart-btn").addEventListener("click",O),document.querySelector("#start-btn").addEventListener("click",H),document.querySelector("#auto-ship").addEventListener("click",Y),document.querySelector("#rotate").addEventListener("click",q),document.querySelector("#undo-ship").addEventListener("click",B),document.querySelector("#reset-ship").addEventListener("click",O),(()=>{const e=document.querySelector("#player-board");e.addEventListener("mouseover",(e=>{const t=P();((e,t)=>{if(e.target.classList.contains("board")||null===t)return;const r=((e,t,r,o)=>{const[s,n]=e,a=[];if("x"===r)for(let e=0;e<t&&!(e+s>9);e++){const t=o.querySelector(`[data-x='${e+s}'][data-y='${n}']`);a.push(t)}if("y"===r)for(let e=0;e<t&&!(e+n>9);e++){const t=o.querySelector(`[data-x='${s}'][data-y='${e+n}']`);a.push(t)}return a})(y(e.target),t,k(),L),o=((e,t)=>{const r=e.length===t,o=e.every((e=>!e.classList.contains("ship")));return r&&o})(r,t);o?r.forEach((e=>e.classList.add("ship-preview"))):r.forEach((e=>e.classList.add("invalid")))})(e,g(t))})),e.addEventListener("mouseout",w),e.addEventListener("click",R)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVksR0FDekMxRyxFQUFZMEcsaUJBQWlCLFFBQVMsSURoQ3hDLEkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvcGxheWVyRmFjdG9yeS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvZ2FtZWJvYXJkRmFjdG9yeS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvc2hpcEZhY3RvcnkuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL2RvbS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvaGVscGVycy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvc2hpcEJ1aWxkZXIuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL2JvdExvZ2ljLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9nYW1lLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL2V2ZW50Q29udHJvbGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZ2FtZWJvYXJkRmFjdG9yeSBmcm9tICcuL2dhbWVib2FyZEZhY3RvcnknO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBwbGF5ZXJGYWN0b3J5KG51bSwgaHVtYW4pIHtcbiAgY29uc3QgZ2FtZWJvYXJkID0gZ2FtZWJvYXJkRmFjdG9yeSgpO1xuICBjb25zdCBtb3ZlcyA9IFtdO1xuICBjb25zdCBtYWtlTW92ZSA9ICh0YXJnZXQsIGVuZW15Qm9hcmQpID0+IHtcbiAgICBlbmVteUJvYXJkLnJlY2VpdmVBdHRhY2sodGFyZ2V0KTtcbiAgICBtb3Zlcy5wdXNoKHRhcmdldCk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBnZXQgbnVtKCkge1xuICAgICAgcmV0dXJuIG51bTtcbiAgICB9LFxuICAgIGdldCBib2FyZCgpIHtcbiAgICAgIHJldHVybiBnYW1lYm9hcmQ7XG4gICAgfSxcbiAgICBnZXQgaXNIdW1hbigpIHtcbiAgICAgIHJldHVybiBodW1hbjtcbiAgICB9LFxuICAgIGdldCBtb3ZlcygpIHtcbiAgICAgIHJldHVybiBtb3ZlcztcbiAgICB9LFxuICAgIG1ha2VNb3ZlLFxuICB9O1xufVxuIiwiaW1wb3J0IHNoaXBGYWN0b3J5IGZyb20gJy4vc2hpcEZhY3RvcnknO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBnYW1lYm9hcmRGYWN0b3J5KCkge1xuICBjb25zdCBjcmVhdGVCb2FyZCA9ICgpID0+IHtcbiAgICBjb25zdCBnYW1lYm9hcmQgPSBuZXcgQXJyYXkoMTApO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgZ2FtZWJvYXJkW2ldID0ge307XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgZ2FtZWJvYXJkW2ldW2pdID0ge1xuICAgICAgICAgIGhpdDogZmFsc2UsXG4gICAgICAgICAgc2hpcElkOiBudWxsLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZ2FtZWJvYXJkO1xuICB9O1xuXG4gIGNvbnN0IHRpbGVzID0gY3JlYXRlQm9hcmQoKTtcblxuICBjb25zdCBzaGlwcyA9IFtdO1xuXG4gIGNvbnN0IG1hcFNoaXBJZCA9IChsZW5ndGgpID0+IHtcbiAgICBsZXQgaWQ7XG4gICAgc3dpdGNoIChsZW5ndGgpIHtcbiAgICAgIGNhc2UgNTpcbiAgICAgICAgaWQgPSAwO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgaWQgPSAxO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaWQgPSA0O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgaWQgPSBzaGlwcy5zb21lKChzaGlwKSA9PiBzaGlwLmlkID09PSAyKSA/IDMgOiAyO1xuICAgICAgICBicmVhaztcbiAgICAgIC8vIE5vIGRlZmF1bHRcbiAgICB9XG4gICAgcmV0dXJuIGlkO1xuICB9O1xuXG4gIGNvbnN0IHBsYWNlU2hpcCA9IChsZW5ndGgsIFt4LCB5XSwgYXhpcykgPT4ge1xuICAgIGNvbnN0IHNoaXBJZCA9IG1hcFNoaXBJZChsZW5ndGgpO1xuICAgIGNvbnN0IG5ld1NoaXAgPSBzaGlwRmFjdG9yeShzaGlwSWQsIGxlbmd0aCk7XG4gICAgc2hpcHMucHVzaChuZXdTaGlwKTtcbiAgICBpZiAoYXhpcyA9PT0gJ3gnKSB7XG4gICAgICAvLyBQbGFjZSBob3Jpem9udGFsbHlcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbmV3U2hpcC5sZW5ndGg7IGkrKykge1xuICAgICAgICBuZXdTaGlwLmNvb3Jkcy5wdXNoKFt4LCB5XSk7XG4gICAgICAgIHRpbGVzW3hdW3ldLnNoaXBJZCA9IG5ld1NoaXAuaWQ7XG4gICAgICAgIHggKz0gMTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGF4aXMgPT09ICd5Jykge1xuICAgICAgLy8gUGxhY2UgdmVydGljYWxseVxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuZXdTaGlwLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIG5ld1NoaXAuY29vcmRzLnB1c2goW3gsIHldKTtcbiAgICAgICAgdGlsZXNbeF1beV0uc2hpcElkID0gbmV3U2hpcC5pZDtcbiAgICAgICAgeSArPSAxO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBjb25zdCByZW1vdmVMYXN0U2hpcCA9ICgpID0+IHtcbiAgICBjb25zdCBbc2hpcF0gPSBzaGlwcy5zcGxpY2Uoc2hpcHMubGVuZ3RoIC0gMSwgMSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwLmNvb3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgW3gsIHldID0gc2hpcC5jb29yZHNbaV07XG4gICAgICB0aWxlc1t4XVt5XS5zaGlwSWQgPSBudWxsO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBoYXNTaGlwID0gKHgsIHkpID0+IHRpbGVzW3hdW3ldLnNoaXBJZCAhPT0gbnVsbDtcblxuICBjb25zdCBmaW5kU2hpcCA9IChpZCkgPT4ge1xuICAgIGxldCB0aGlzU2hpcDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoc2hpcHNbaV0uaWQgPT09IGlkKSB7XG4gICAgICAgIHRoaXNTaGlwID0gc2hpcHNbaV07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzU2hpcDtcbiAgfTtcblxuICBjb25zdCByZWNlaXZlQXR0YWNrID0gKHRhcmdldCkgPT4ge1xuICAgIGNvbnN0IFt4LCB5XSA9IHRhcmdldDtcbiAgICBjb25zdCB0aGlzVGlsZSA9IHRpbGVzW3hdW3ldO1xuICAgIGlmICh0aGlzVGlsZS5oaXQpIHJldHVybjtcblxuICAgIGlmIChoYXNTaGlwKHgsIHkpKSB7XG4gICAgICBjb25zdCB0aGlzU2hpcCA9IGZpbmRTaGlwKHRoaXNUaWxlLnNoaXBJZCk7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXNTaGlwLmNvb3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgdGhpc1NoaXAuY29vcmRzW2ldLmV2ZXJ5KCh2YWx1ZSwgaW5kZXgpID0+IHZhbHVlID09PSB0YXJnZXRbaW5kZXhdKVxuICAgICAgICApIHtcbiAgICAgICAgICB0aGlzU2hpcC5oZWFsdGhbaV0gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXNUaWxlLmhpdCA9IHRydWU7XG4gIH07XG5cbiAgY29uc3Qgc2hpcHNSZW1haW5pbmcgPSAoKSA9PiB7XG4gICAgY29uc3QgZmlsdGVyU2hpcHMgPSBzaGlwcy5maWx0ZXIoKHNoaXApID0+IHNoaXAuaXNTdW5rKCkgPT09IGZhbHNlKTtcbiAgICByZXR1cm4gZmlsdGVyU2hpcHMubGVuZ3RoO1xuICB9O1xuXG4gIGNvbnN0IGFsbFNoaXBzU3VuayA9ICgpID0+IHtcbiAgICBjb25zdCBzdW5rU2hpcHMgPSBzaGlwc1JlbWFpbmluZygpO1xuICAgIHJldHVybiBzdW5rU2hpcHMgPT09IDA7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICB0aWxlcyxcbiAgICBzaGlwcyxcbiAgICBwbGFjZVNoaXAsXG4gICAgaGFzU2hpcCxcbiAgICByZWNlaXZlQXR0YWNrLFxuICAgIHNoaXBzUmVtYWluaW5nLFxuICAgIGFsbFNoaXBzU3VuayxcbiAgICByZW1vdmVMYXN0U2hpcCxcbiAgfTtcbn1cbiIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHNoaXBGYWN0b3J5KGlkLCBsZW5ndGgpIHtcbiAgY29uc3QgY3JlYXRlSGVhbHRoID0gKHNpemUpID0+IHtcbiAgICBjb25zdCBhcnJheSA9IFsuLi5BcnJheShzaXplKS5rZXlzKCldO1xuICAgIGNvbnN0IGhlYWx0aCA9IGFycmF5LnJlZHVjZSgocHJldiwgY3VycikgPT4ge1xuICAgICAgcHJldltjdXJyXSA9IGZhbHNlO1xuICAgICAgcmV0dXJuIHByZXY7XG4gICAgfSwge30pO1xuICAgIHJldHVybiBoZWFsdGg7XG4gIH07XG5cbiAgY29uc3QgY29vcmRzID0gW107XG5cbiAgY29uc3QgaGVhbHRoID0gY3JlYXRlSGVhbHRoKGxlbmd0aCk7XG4gIC8vIGhlYWx0aCA9IHsgd2hlcmUgYm9vbCByZXByZXNlbnRzIGhpdC9ubyBoaXRcbiAgLy8gICAwOiBmYWxzZSxcbiAgLy8gICAxOiBmYWxzZSxcbiAgLy8gICAyOiBmYWxzZSxcbiAgLy8gfVxuICBjb25zdCBoaXQgPSAoaW5kZXgpID0+IHtcbiAgICBoZWFsdGhbaW5kZXhdID0gdHJ1ZTtcbiAgfTtcblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgcmV0dXJuIE9iamVjdC52YWx1ZXMoaGVhbHRoKS5ldmVyeSgoaW5kZXgpID0+IGluZGV4ID09PSB0cnVlKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGlkLFxuICAgIGxlbmd0aCxcbiAgICBoZWFsdGgsXG4gICAgY29vcmRzLFxuICAgIGhpdCxcbiAgICBpc1N1bmssXG4gIH07XG59XG4iLCJjb25zdCBnYW1lYm9hcmRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJvYXJkJyk7XG5jb25zdCBwbGF5ZXJCb2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwbGF5ZXItYm9hcmQnKTtcbmNvbnN0IGNvbUJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2NvbS1ib2FyZCcpO1xuY29uc3QgZ2FtZUluZm8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZ2FtZS1pbmZvJyk7XG5cbmNvbnN0IHVwZGF0ZVNoaXBDb3VudCA9IChwbGF5ZXIpID0+IHtcbiAgY29uc3QgdGhpc0JvYXJkID0gcGxheWVyLmlzSHVtYW4gPyBwbGF5ZXJCb2FyZCA6IGNvbUJvYXJkO1xuICBjb25zdCBzaGlwQ291bnRlciA9IHRoaXNCb2FyZC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xuICBjb25zdCBzaGlwc1JlbWFpbmluZyA9IHBsYXllci5ib2FyZC5zaGlwc1JlbWFpbmluZygpO1xuXG4gIHNoaXBDb3VudGVyLnRleHRDb250ZW50ID0gYFNoaXBzIHJlbWFpbmluZzogJHtzaGlwc1JlbWFpbmluZ31gO1xufTtcblxuY29uc3QgaGlkZVNoaXBDb3VudCA9IChib29sKSA9PiB7XG4gIGNvbnN0IHNoaXBDb3VudGVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zaGlwLWNvdW50ZXInKTtcbiAgaWYgKGJvb2wpIHtcbiAgICBzaGlwQ291bnRlcnMuZm9yRWFjaCgoZWxlbWVudCkgPT4gZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdvcGFjaXR5LTAnKSk7XG4gIH0gZWxzZSB7XG4gICAgc2hpcENvdW50ZXJzLmZvckVhY2goKGVsZW1lbnQpID0+IGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnb3BhY2l0eS0wJykpO1xuICB9XG59O1xuXG5jb25zdCBjcmVhdGVCb2FyZHMgPSAoKSA9PiB7XG4gIGdhbWVib2FyZHMuZm9yRWFjaCgoYm9hcmQpID0+IHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGorKykge1xuICAgICAgICBjb25zdCBib2FyZENlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblxuICAgICAgICBib2FyZENlbGwuY2xhc3NMaXN0LmFkZCgnYm9hcmQtY2VsbCcpO1xuICAgICAgICBib2FyZENlbGwuZGF0YXNldC54ID0gajtcbiAgICAgICAgYm9hcmRDZWxsLmRhdGFzZXQueSA9IGk7XG4gICAgICAgIGJvYXJkLmFwcGVuZENoaWxkKGJvYXJkQ2VsbCk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG5cbmNvbnN0IHJlbmRlclNoaXBzID0gKHBsYXllcikgPT4ge1xuICBjb25zdCBib2FyZCA9IHBsYXllci5pc0h1bWFuID8gcGxheWVyQm9hcmQgOiBjb21Cb2FyZDtcbiAgY29uc3QgeyBzaGlwcyB9ID0gcGxheWVyLmJvYXJkO1xuXG4gIGNvbnN0IHNoaXBLZXlzID0gT2JqZWN0LmtleXMoc2hpcHMpO1xuICBzaGlwS2V5cy5mb3JFYWNoKChrZXkpID0+IHtcbiAgICBjb25zdCBzaGlwID0gc2hpcHNba2V5XTtcbiAgICBjb25zdCB7IGlkIH0gPSBzaGlwO1xuICAgIGNvbnN0IHsgY29vcmRzIH0gPSBzaGlwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29vcmRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBbeCwgeV0gPSBjb29yZHNbaV07XG4gICAgICBjb25zdCB0aGlzQ2VsbCA9IGJvYXJkLnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXg9JyR7eH0nXVtkYXRhLXk9JyR7eX0nXWApO1xuICAgICAgdGhpc0NlbGwuY2xhc3NMaXN0LmFkZCgnc2hpcCcpO1xuICAgICAgdGhpc0NlbGwuZGF0YXNldC5zaGlwSWQgPSBpZDtcbiAgICB9XG4gIH0pO1xuICB1cGRhdGVTaGlwQ291bnQocGxheWVyKTtcbn07XG5cbmNvbnN0IHVwZGF0ZUJvYXJkID0gKHBsYXllcikgPT4ge1xuICBjb25zdCB0aGlzQm9hcmQgPSBwbGF5ZXIuaXNIdW1hbiA/IHBsYXllckJvYXJkIDogY29tQm9hcmQ7XG4gIGNvbnN0IHsgYm9hcmQgfSA9IHBsYXllcjtcbiAgY29uc3QgeyB0aWxlcyB9ID0gYm9hcmQ7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgdGlsZXMubGVuZ3RoOyBpKyspIHtcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IE9iamVjdC5rZXlzKHRpbGVzW2ldKS5sZW5ndGg7IGorKykge1xuICAgICAgY29uc3QgdGhpc1RpbGUgPSB0aWxlc1tpXVtqXTtcbiAgICAgIGNvbnN0IGhhc1NoaXAgPSBib2FyZC5oYXNTaGlwKGksIGopO1xuICAgICAgaWYgKHRoaXNUaWxlLmhpdCkge1xuICAgICAgICBjb25zdCB0aGlzQ2VsbCA9IHRoaXNCb2FyZC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgIGBbZGF0YS14PScke2l9J11bZGF0YS15PScke2p9J11gXG4gICAgICAgICk7XG4gICAgICAgIGlmIChoYXNTaGlwKSB7XG4gICAgICAgICAgdGhpc0NlbGwuY2xhc3NMaXN0LmFkZCgnaGl0Jyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpc0NlbGwuY2xhc3NMaXN0LmFkZCgnbWlzcycpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHVwZGF0ZVNoaXBDb3VudChwbGF5ZXIpO1xufTtcblxuY29uc3Qgc3R5bGVHYW1lT3ZlciA9IChib29sKSA9PiB7XG4gIGlmIChib29sKSB7XG4gICAgZ2FtZWJvYXJkcy5mb3JFYWNoKChib2FyZCkgPT4gYm9hcmQuY2xhc3NMaXN0LmFkZCgnZ2FtZS1vdmVyJykpO1xuICB9IGVsc2Uge1xuICAgIGdhbWVib2FyZHMuZm9yRWFjaCgoYm9hcmQpID0+IGJvYXJkLmNsYXNzTGlzdC5yZW1vdmUoJ2dhbWUtb3ZlcicpKTtcbiAgfVxufTtcblxuY29uc3QgY2xlYXJVSSA9ICguLi5wbGF5ZXJzKSA9PiB7XG4gIGdhbWVib2FyZHMuZm9yRWFjaCgoYm9hcmQpID0+IHtcbiAgICBjb25zdCBjZWxscyA9IGJvYXJkLnF1ZXJ5U2VsZWN0b3JBbGwoJy5ib2FyZC1jZWxsJyk7XG4gICAgY2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgY2VsbC5jbGFzc0xpc3QucmVtb3ZlKCdtaXNzJywgJ2hpdCcsICdzaGlwJyk7XG4gICAgICBjZWxsLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1zaGlwLWlkJyk7XG4gICAgfSk7XG4gIH0pO1xuICBwbGF5ZXJzLmZvckVhY2goKHBsYXllcikgPT4gdXBkYXRlU2hpcENvdW50KHBsYXllcikpO1xuICBzdHlsZUdhbWVPdmVyKGZhbHNlKTtcbn07XG5cbmNvbnN0IGdhbWVNZXNzYWdlID0gKHN0YXRlLCBudW1TaGlwcykgPT4ge1xuICBjb25zdCByZW1haW5pbmdTaGlwcyA9IDUgLSBudW1TaGlwcztcbiAgY29uc3QgbWVzc2FnZXMgPSB7XG4gICAgc2V0dXA6IGBCb2FyZCBzZXR1cCAuLi4gJHtyZW1haW5pbmdTaGlwc30gc2hpcChzKSB0byBwbGFjZWAsXG4gICAgcmVhZHk6ICdHYW1lIHJlYWR5IHRvIHN0YXJ0JyxcbiAgICBwMVR1cm46ICdQbGF5ZXJcXCdzIHR1cm4nLFxuICAgIGNvbVR1cm46ICd0aGlua2luZyAuLi4nLFxuICB9O1xuICBnYW1lSW5mby50ZXh0Q29udGVudCA9IG1lc3NhZ2VzW3N0YXRlXTtcbn07XG5cbmNvbnN0IGFubm91bmNlR2FtZU92ZXIgPSAod2lubmVyKSA9PiB7XG4gIGNvbnN0IHdpbk1lc3NhZ2UgPVxuICAgIHdpbm5lci5udW0gPT09IDFcbiAgICAgID8gJ0NvbmdyYXR1bGF0aW9ucyEgWW91IHdpbiEnXG4gICAgICA6ICdHYW1lIG92ZXIgLi4uIENvbXB1dGVyIHdpbnMhJztcblxuICBnYW1lSW5mby50ZXh0Q29udGVudCA9IHdpbk1lc3NhZ2U7XG4gIHN0eWxlR2FtZU92ZXIodHJ1ZSk7XG59O1xuXG5jb25zdCBkaXNhYmxlRXZlbnRzID0gKGJvb2wsIGJvYXJkKSA9PiB7XG4gIGNvbnN0IHRoaXNCb2FyZCA9IGJvYXJkID09PSAnY29tJyA/IGNvbUJvYXJkIDogcGxheWVyQm9hcmQ7XG4gIGlmIChib29sKSB7XG4gICAgdGhpc0JvYXJkLmNsYXNzTGlzdC5hZGQoJ25vLWV2ZW50cycpO1xuICB9IGVsc2Uge1xuICAgIHRoaXNCb2FyZC5jbGFzc0xpc3QucmVtb3ZlKCduby1ldmVudHMnKTtcbiAgfVxufTtcblxuY29uc3QgdG9nZ2xlU3RhcnQgPSAoc3RhdGUpID0+IHtcbiAgY29uc3Qgc3RhcnRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc3RhcnQtYnRuJyk7XG5cbiAgaWYgKHN0YXRlKSB7XG4gICAgc3RhcnRCdG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgfSBlbHNlIHtcbiAgICBzdGFydEJ0bi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gIH1cbn07XG5cbmNvbnN0IHJlYWR5R2FtZSA9IChsZW5ndGgpID0+IHtcbiAgaWYgKGxlbmd0aCA9PT0gNSkge1xuICAgIHRvZ2dsZVN0YXJ0KGZhbHNlKTtcbiAgICBnYW1lTWVzc2FnZSgncmVhZHknKTtcbiAgfSBlbHNlIHtcbiAgICB0b2dnbGVTdGFydCh0cnVlKTtcbiAgICBnYW1lTWVzc2FnZSgnc2V0dXAnLCBsZW5ndGgpO1xuICB9XG59O1xuXG5jb25zdCBkaXNhYmxlQm9hcmRGdW5jcyA9IChib29sKSA9PiB7XG4gIGNvbnN0IGJvYXJkRnVuY3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYm9hcmQtZnVuY3MnKTtcbiAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3BsYXllci1idXR0b25zJyk7XG4gIGlmIChib29sKSB7XG4gICAgYm9hcmRGdW5jcy5mb3JFYWNoKChidXR0b24pID0+IGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpKTtcbiAgICBidXR0b25Db250YWluZXIuY2xhc3NMaXN0LmFkZCgnb3BhY2l0eS0wJyk7XG4gIH0gZWxzZSB7XG4gICAgYm9hcmRGdW5jcy5mb3JFYWNoKChidXR0b24pID0+IGJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpO1xuICAgIGJ1dHRvbkNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdvcGFjaXR5LTAnKTtcbiAgfVxufTtcblxuZXhwb3J0IHtcbiAgY3JlYXRlQm9hcmRzLFxuICBjbGVhclVJLFxuICByZW5kZXJTaGlwcyxcbiAgdXBkYXRlQm9hcmQsXG4gIGRpc2FibGVFdmVudHMsXG4gIGFubm91bmNlR2FtZU92ZXIsXG4gIHRvZ2dsZVN0YXJ0LFxuICByZWFkeUdhbWUsXG4gIGRpc2FibGVCb2FyZEZ1bmNzLFxuICBnYW1lTWVzc2FnZSxcbiAgaGlkZVNoaXBDb3VudCxcbn07XG4iLCJjb25zdCBnZXRDZWxsSW5mbyA9ICh0YXJnZXQpID0+IHtcbiAgcmV0dXJuIFtOdW1iZXIodGFyZ2V0LmRhdGFzZXQueCksIE51bWJlcih0YXJnZXQuZGF0YXNldC55KV07XG59O1xuXG5jb25zdCBhbHJlYWR5UGxheWVkID0gKHBsYXllciwgdGFyZ2V0KSA9PiB7XG4gIGNvbnN0IHByZXZpb3VzTW92ZXMgPSBwbGF5ZXIubW92ZXM7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcHJldmlvdXNNb3Zlcy5sZW5ndGg7IGkrKykge1xuICAgIGlmIChwcmV2aW91c01vdmVzW2ldLmV2ZXJ5KCh2YWx1ZSwgaW5kZXgpID0+IHZhbHVlID09PSB0YXJnZXRbaW5kZXhdKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG5cbmNvbnN0IHRpbWVvdXQgPSAobXMpID0+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgc2V0VGltZW91dChyZXNvbHZlLCBtcyk7XG4gIH0pO1xufTtcblxuY29uc3QgZ2V0UmFuZG9tVGlsZSA9ICgpID0+IHtcbiAgY29uc3QgcmFuZG9tID0gW1xuICAgIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKSxcbiAgICBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCksXG4gIF07XG4gIHJldHVybiByYW5kb207XG59O1xuXG5jb25zdCBnZXRFbXB0eVRpbGVzID0gKHBsYXllcikgPT4ge1xuICBjb25zdCB7IGJvYXJkIH0gPSBwbGF5ZXI7XG4gIGNvbnN0IHsgdGlsZXMgfSA9IGJvYXJkO1xuICBjb25zdCBlbXB0eVRpbGVzID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgdGlsZXMubGVuZ3RoOyBpKyspIHtcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IE9iamVjdC5rZXlzKHRpbGVzW2ldKS5sZW5ndGg7IGorKykge1xuICAgICAgY29uc3QgaGFzU2hpcCA9IGJvYXJkLmhhc1NoaXAoaSwgaik7XG4gICAgICBpZiAoIWhhc1NoaXApIHtcbiAgICAgICAgY29uc3QgY29vcmQgPSBbaSwgal07XG4gICAgICAgIGVtcHR5VGlsZXMucHVzaChjb29yZCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBlbXB0eVRpbGVzO1xufTtcblxuY29uc3QgZ2V0UmFuZG9tRW1wdHkgPSAocGxheWVyKSA9PiB7XG4gIGNvbnN0IGVtcHR5VGlsZXMgPSBnZXRFbXB0eVRpbGVzKHBsYXllcik7XG5cbiAgcmV0dXJuIGVtcHR5VGlsZXNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogZW1wdHlUaWxlcy5sZW5ndGgpXTtcbn07XG5cbmNvbnN0IG5leHRTaGlwTGVuZ3RoID0gKG51bVNoaXBzUGxhY2VkKSA9PiB7XG4gIHN3aXRjaCAobnVtU2hpcHNQbGFjZWQpIHtcbiAgICBjYXNlIDA6XG4gICAgICByZXR1cm4gNTtcbiAgICBjYXNlIDE6XG4gICAgICByZXR1cm4gNDtcbiAgICBjYXNlIDI6XG4gICAgICByZXR1cm4gMztcbiAgICBjYXNlIDM6XG4gICAgICByZXR1cm4gMztcbiAgICBjYXNlIDQ6XG4gICAgICByZXR1cm4gMjtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIG51bGw7XG4gIH1cbn07XG5cbmNvbnN0IGdldFJhbmRvbUF4aXMgPSAoKSA9PiBbJ3gnLCAneSddW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpXTtcblxuZXhwb3J0IHtcbiAgZ2V0Q2VsbEluZm8sXG4gIGFscmVhZHlQbGF5ZWQsXG4gIHRpbWVvdXQsXG4gIGdldFJhbmRvbVRpbGUsXG4gIGdldFJhbmRvbUVtcHR5LFxuICBuZXh0U2hpcExlbmd0aCxcbiAgZ2V0UmFuZG9tQXhpcyxcbn07XG4iLCJpbXBvcnQgKiBhcyBoZWxwZXJzIGZyb20gJy4vaGVscGVycyc7XG5cbmNvbnN0IHBsYXllckJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3BsYXllci1ib2FyZCcpO1xuXG4vLyBTaGlwIHJvdGF0aW9uIHdoZXJlIHggPSBwbGFjZSBob3Jpem9udGFsbHksIHkgPSBwbGFjZSB2ZXJ0aWNhbGx5XG5jb25zdCBheGVzID0ge1xuICB4OiB0cnVlLFxuICB5OiBmYWxzZSxcbn07XG5cbmNvbnN0IGdldEF4aXMgPSAoKSA9PiB7XG4gIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhheGVzKTtcbiAgcmV0dXJuIGtleXMuZmlsdGVyKChrZXkpID0+IGF4ZXNba2V5XSA9PT0gdHJ1ZSlbMF07XG59O1xuXG5jb25zdCBzd2l0Y2hBeGlzID0gKCkgPT4ge1xuICBheGVzLnggPSAhYXhlcy54O1xuICBheGVzLnkgPSAhYXhlcy54O1xufTtcblxuLy8gUmV0dXJucyBhcnJheSBvZiBbeCwgeV0gY29vcmRzIG9mIGEgc2hpcCBvZiBsZW5ndGgsIGJ1aWx0IG9uIGF4aXMsIGF0IHN0YXJ0IGluZGV4XG5jb25zdCBidWlsZFNoaXAgPSAoc3RhcnQsIGF4aXMsIGxlbmd0aCkgPT4ge1xuICBjb25zdCBbeCwgeV0gPSBzdGFydDtcbiAgY29uc3Qgc2hpcENvb3JkcyA9IFtdO1xuXG4gIGlmIChheGlzID09PSAneCcpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICBzaGlwQ29vcmRzLnB1c2goW2kgKyB4LCB5XSk7XG4gICAgfVxuICB9XG5cbiAgaWYgKGF4aXMgPT09ICd5Jykge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIHNoaXBDb29yZHMucHVzaChbeCwgaSArIHldKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gc2hpcENvb3Jkcztcbn07XG5cbi8qIFZhbGlkIGNoZWNrcyBmb3Igc2hpcCBvYmplY3Qgb24gYm9hcmQgb2JqZWN0ICovXG4vLyAgQ2hlY2sgaWYgc2hpcCBvZiBsZW5ndGggJiBheGlzIGZpdHMgd2l0aGluIDEweDEwIGdhbWVib2FyZCBib3VuZGFyaWVzXG5jb25zdCBkb2VzU2hpcEZpdCA9IChsZW5ndGgsIGF4aXMsIHN0YXJ0SW5kZXgpID0+IHtcbiAgY29uc3QgW3gsIHldID0gc3RhcnRJbmRleDtcbiAgaWYgKGF4aXMgPT09ICd4Jykge1xuICAgIHJldHVybiB4ICsgbGVuZ3RoIC0gMSA8PSA5O1xuICB9XG4gIGlmIChheGlzID09PSAneScpIHtcbiAgICByZXR1cm4geSArIGxlbmd0aCAtIDEgPD0gOTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xuXG4vLyBDaGVja3Mgc2hpcCBkb2VzIG5vdCBvdmVybGFwIHdpdGggYW5vdGhlclxuY29uc3Qgbm9PdmVybGFwID0gKHNoaXAsIHBsYXllcikgPT4ge1xuICBjb25zdCB7IGJvYXJkIH0gPSBwbGF5ZXI7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcC5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IFt4LCB5XSA9IHNoaXBbaV07XG4gICAgaWYgKGJvYXJkLmhhc1NoaXAoeCwgeSkgPT09IHRydWUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xuXG5jb25zdCBpc1NoaXBWYWxpZCA9IChwbGF5ZXIsIHN0YXJ0LCBheGlzLCBsZW5ndGgpID0+IHtcbiAgY29uc3Qgc2hpcEZpdHMgPSBkb2VzU2hpcEZpdChsZW5ndGgsIGF4aXMsIHN0YXJ0KTtcblxuICBpZiAoc2hpcEZpdHMpIHtcbiAgICBjb25zdCBzaGlwID0gYnVpbGRTaGlwKHN0YXJ0LCBheGlzLCBsZW5ndGgpO1xuICAgIGlmIChub092ZXJsYXAoc2hpcCwgcGxheWVyKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG5cbi8qIFByZXZpZXdpbmcgc2hpcCBwbGFjZW1lbnQgb24gRE9NICovXG5jb25zdCBpc1ByZXZpZXdWYWxpZCA9IChjb29yZHMsIGxlbmd0aCkgPT4ge1xuICBjb25zdCBpc1dpdGhpbkJvdW5kcyA9IGNvb3Jkcy5sZW5ndGggPT09IGxlbmd0aDtcbiAgY29uc3Qgbm9PdGhlclNoaXBzID0gY29vcmRzLmV2ZXJ5KFxuICAgIChjb29yZCkgPT4gIWNvb3JkLmNsYXNzTGlzdC5jb250YWlucygnc2hpcCcpXG4gICk7XG4gIHJldHVybiBpc1dpdGhpbkJvdW5kcyAmJiBub090aGVyU2hpcHM7XG59O1xuXG5jb25zdCBidWlsZFByZXZpZXcgPSAoc3RhcnQsIGxlbmd0aCwgYXhpcywgYm9hcmQpID0+IHtcbiAgY29uc3QgW3gsIHldID0gc3RhcnQ7XG4gIGNvbnN0IHNoaXBDb29yZHMgPSBbXTtcblxuICBpZiAoYXhpcyA9PT0gJ3gnKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgLy8gPjkgPSBvdXQgb2YgYm91bmRzXG4gICAgICBpZiAoaSArIHggPiA5KSBicmVhaztcbiAgICAgIGNvbnN0IG5leHRDZWxsID0gYm9hcmQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgYFtkYXRhLXg9JyR7aSArIHh9J11bZGF0YS15PScke3l9J11gXG4gICAgICApO1xuICAgICAgc2hpcENvb3Jkcy5wdXNoKG5leHRDZWxsKTtcbiAgICB9XG4gIH1cblxuICBpZiAoYXhpcyA9PT0gJ3knKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgLy8gPjkgPSBvdXQgb2YgYm91bmRzXG4gICAgICBpZiAoaSArIHkgPiA5KSBicmVhaztcblxuICAgICAgY29uc3QgbmV4dENlbGwgPSBib2FyZC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICBgW2RhdGEteD0nJHt4fSddW2RhdGEteT0nJHtpICsgeX0nXWBcbiAgICAgICk7XG4gICAgICBzaGlwQ29vcmRzLnB1c2gobmV4dENlbGwpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBzaGlwQ29vcmRzO1xufTtcblxuY29uc3QgcHJldmlld1NoaXAgPSAoZSwgbGVuZ3RoKSA9PiB7XG4gIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2JvYXJkJykgfHwgbGVuZ3RoID09PSBudWxsKSByZXR1cm47XG5cbiAgY29uc3Qgc3RhcnRpbmdJbmRleCA9IGhlbHBlcnMuZ2V0Q2VsbEluZm8oZS50YXJnZXQpO1xuICBjb25zdCBheGlzID0gZ2V0QXhpcygpO1xuICBjb25zdCBzaGlwQ29vcmRzID0gYnVpbGRQcmV2aWV3KHN0YXJ0aW5nSW5kZXgsIGxlbmd0aCwgYXhpcywgcGxheWVyQm9hcmQpO1xuICBjb25zdCB2YWxpZFByZXZpZXcgPSBpc1ByZXZpZXdWYWxpZChzaGlwQ29vcmRzLCBsZW5ndGgpO1xuXG4gIGlmICh2YWxpZFByZXZpZXcpIHtcbiAgICBzaGlwQ29vcmRzLmZvckVhY2goKGNlbGwpID0+IGNlbGwuY2xhc3NMaXN0LmFkZCgnc2hpcC1wcmV2aWV3JykpO1xuICB9IGVsc2Uge1xuICAgIHNoaXBDb29yZHMuZm9yRWFjaCgoY2VsbCkgPT4gY2VsbC5jbGFzc0xpc3QuYWRkKCdpbnZhbGlkJykpO1xuICB9XG59O1xuXG5jb25zdCBjbGVhclByZXZpZXcgPSAoKSA9PiB7XG4gIGNvbnN0IGNlbGxzID0gcGxheWVyQm9hcmQucXVlcnlTZWxlY3RvckFsbCgnLmJvYXJkLWNlbGwnKTtcbiAgY2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4gY2VsbC5jbGFzc0xpc3QucmVtb3ZlKCdzaGlwLXByZXZpZXcnLCAnaW52YWxpZCcpKTtcbn07XG5cbmV4cG9ydCB7XG4gIGJ1aWxkU2hpcCxcbiAgbm9PdmVybGFwLFxuICBkb2VzU2hpcEZpdCxcbiAgZ2V0QXhpcyxcbiAgc3dpdGNoQXhpcyxcbiAgcHJldmlld1NoaXAsXG4gIGNsZWFyUHJldmlldyxcbiAgaXNTaGlwVmFsaWQsXG59O1xuIiwiaW1wb3J0ICogYXMgaGVscGVycyBmcm9tICcuL2hlbHBlcnMnO1xuaW1wb3J0ICogYXMgc2hpcEJ1aWxkZXIgZnJvbSAnLi9zaGlwQnVpbGRlcic7XG5cbi8vIFJhbmRvbSBtb3ZlIChhdHRhY2spXG5jb25zdCBhdXRvQXR0YWNrID0gYXN5bmMgKHBsYXllcikgPT4ge1xuICBsZXQgcmFuZG9tTW92ZSA9IGhlbHBlcnMuZ2V0UmFuZG9tVGlsZSgpO1xuICB3aGlsZSAoaGVscGVycy5hbHJlYWR5UGxheWVkKHBsYXllciwgcmFuZG9tTW92ZSkpIHtcbiAgICByYW5kb21Nb3ZlID0gaGVscGVycy5nZXRSYW5kb21UaWxlKCk7XG4gIH1cbiAgYXdhaXQgaGVscGVycy50aW1lb3V0KDQwMCk7XG4gIHJldHVybiByYW5kb21Nb3ZlO1xufTtcblxuLyogUmFuZG9tIHNoaXAgcGxhY2VtZW50ICovXG4vKiBSZXR1cm5zIGEgcmFuZG9tIHN0YXJ0aW5nSW5kZXggJiBheGlzICh0byBwbGFjZSBhIHNoaXApIHRoYXQgd2lsbCBmaXQgd2l0aGluIFxuICAxMHgxMCBib2FyZCAqL1xuY29uc3QgZ2V0VmFsaWRTdGFydCA9IChwbGF5ZXIsIGxlbmd0aCkgPT4ge1xuICBsZXQgc3RhcnRJbmRleDtcbiAgbGV0IGF4aXM7XG4gIGxldCBzaGlwRml0cyA9IGZhbHNlO1xuICB3aGlsZSAoIXNoaXBGaXRzKSB7XG4gICAgY29uc3QgcmFuZG9tSW5kZXggPSBoZWxwZXJzLmdldFJhbmRvbUVtcHR5KHBsYXllcik7XG4gICAgY29uc3QgcmFuZG9tQXhpcyA9IGhlbHBlcnMuZ2V0UmFuZG9tQXhpcygpO1xuICAgIHNoaXBGaXRzID0gc2hpcEJ1aWxkZXIuZG9lc1NoaXBGaXQobGVuZ3RoLCByYW5kb21BeGlzLCByYW5kb21JbmRleCk7XG4gICAgc3RhcnRJbmRleCA9IHJhbmRvbUluZGV4O1xuICAgIGF4aXMgPSByYW5kb21BeGlzO1xuICB9XG4gIHJldHVybiBbc3RhcnRJbmRleCwgYXhpc107XG59O1xuXG4vKiBHZW5lcmF0ZXMgYSByYW5kb20gc2hpcCBwb3NpdGlvbiB0aGF0IHBhc3NlcyBjaGVja3M6XG4gIDEuIHNoaXAgb2YgbGVuZ3RoIGEsIHBsYWNlZCBvbiBheGlzIGIgd2lsbCBmaXQgd2l0aGluIHRoZSAxMHgxMCBib2FyZFxuICAyLiBzaGlwIGRvZXMgbm90IG92ZXJsYXAgd2l0aCBhbiBhbHJlYWR5IHBsYWNlZCBzaGlwICovXG5jb25zdCByYW5kb21TaGlwID0gKHBsYXllciwgbGVuZ3RoKSA9PiB7XG4gIGxldCBzdGFydDtcbiAgbGV0IGF4aXM7XG4gIGxldCB2YWxpZCA9IGZhbHNlO1xuICB3aGlsZSAoIXZhbGlkKSB7XG4gICAgY29uc3QgW3JhbmRvbUluZGV4LCByYW5kb21BeGlzXSA9IGdldFZhbGlkU3RhcnQocGxheWVyLCBsZW5ndGgpO1xuICAgIGNvbnN0IHNoaXAgPSBzaGlwQnVpbGRlci5idWlsZFNoaXAocmFuZG9tSW5kZXgsIHJhbmRvbUF4aXMsIGxlbmd0aCk7XG4gICAgdmFsaWQgPSBzaGlwQnVpbGRlci5ub092ZXJsYXAoc2hpcCwgcGxheWVyKTtcbiAgICBzdGFydCA9IHJhbmRvbUluZGV4O1xuICAgIGF4aXMgPSByYW5kb21BeGlzO1xuICB9XG4gIHJldHVybiBbc3RhcnQsIGF4aXNdO1xufTtcblxuY29uc3QgYXV0b1BsYWNlID0gKHBsYXllciwgc2hpcHNTb0ZhciA9IDApID0+IHtcbiAgY29uc3Qgc2hpcHMgPSBbNSwgNCwgMywgMywgMl07XG5cbiAgZm9yIChsZXQgaSA9IHNoaXBzU29GYXI7IGkgPCBzaGlwcy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGxlbmd0aCA9IHNoaXBzW2ldO1xuICAgIGNvbnN0IHNoaXAgPSByYW5kb21TaGlwKHBsYXllciwgbGVuZ3RoKTtcbiAgICBwbGF5ZXIuYm9hcmQucGxhY2VTaGlwKGxlbmd0aCwgLi4uc2hpcCk7XG4gIH1cbn07XG5cbmV4cG9ydCB7IGF1dG9BdHRhY2ssIGF1dG9QbGFjZSB9O1xuIiwiaW1wb3J0IHBsYXllckZhY3RvcnkgZnJvbSAnLi9wbGF5ZXJGYWN0b3J5JztcbmltcG9ydCAqIGFzIGRvbSBmcm9tICcuL2RvbSc7XG5pbXBvcnQgKiBhcyBoZWxwZXJzIGZyb20gJy4vaGVscGVycyc7XG5pbXBvcnQgKiBhcyBzaGlwQnVpbGRlciBmcm9tICcuL3NoaXBCdWlsZGVyJztcbmltcG9ydCAqIGFzIGJvdExvZ2ljIGZyb20gJy4vYm90TG9naWMnO1xuXG5jb25zdCBwbGF5ZXJzID0ge1xuICBwMTogbnVsbCxcbiAgY29tOiBudWxsLFxufTtcblxuY29uc3QgY2hlY2tHYW1lU3RhdGUgPSAocGxheWVyKSA9PiBwbGF5ZXIuYm9hcmQuYWxsU2hpcHNTdW5rKCk7XG5cbmNvbnN0IG5ld0dhbWUgPSAoKSA9PiB7XG4gIHBsYXllcnMucDEgPSBwbGF5ZXJGYWN0b3J5KDEsIHRydWUpO1xuICBwbGF5ZXJzLmNvbSA9IHBsYXllckZhY3RvcnkoMiwgZmFsc2UpO1xuXG4gIGRvbS5jbGVhclVJKHBsYXllcnMucDEsIHBsYXllcnMuY29tKTtcbiAgZG9tLnRvZ2dsZVN0YXJ0KHRydWUpO1xuICBkb20uZGlzYWJsZUV2ZW50cyh0cnVlLCAnY29tJyk7XG4gIGRvbS5kaXNhYmxlRXZlbnRzKGZhbHNlLCAncGxheWVyJyk7XG4gIGRvbS5kaXNhYmxlQm9hcmRGdW5jcyhmYWxzZSk7XG4gIGRvbS5nYW1lTWVzc2FnZSgnc2V0dXAnLCBwbGF5ZXJzLnAxLmJvYXJkLnNoaXBzLmxlbmd0aCk7XG4gIGRvbS5oaWRlU2hpcENvdW50KHRydWUpO1xufTtcblxuY29uc3Qgc3RhcnRHYW1lID0gKCkgPT4ge1xuICBib3RMb2dpYy5hdXRvUGxhY2UocGxheWVycy5jb20pO1xuXG4gIGRvbS50b2dnbGVTdGFydCh0cnVlKTtcbiAgZG9tLnVwZGF0ZUJvYXJkKHBsYXllcnMuY29tKTtcbiAgZG9tLmRpc2FibGVFdmVudHModHJ1ZSwgJ3BsYXllcicpO1xuICBkb20uZGlzYWJsZUV2ZW50cyhmYWxzZSwgJ2NvbScpO1xuICBkb20uZGlzYWJsZUJvYXJkRnVuY3ModHJ1ZSk7XG4gIGRvbS5nYW1lTWVzc2FnZSgncDFUdXJuJyk7XG4gIGRvbS5oaWRlU2hpcENvdW50KGZhbHNlKTtcbn07XG5cbmNvbnN0IGVuZEdhbWUgPSAod2lubmVyKSA9PiB7XG4gIGRvbS5kaXNhYmxlRXZlbnRzKHRydWUsICdjb20nKTtcbiAgZG9tLmFubm91bmNlR2FtZU92ZXIod2lubmVyKTtcbn07XG5cbmNvbnN0IHBsYXlDb21Nb3ZlID0gYXN5bmMgKCkgPT4ge1xuICBjb25zdCB7IHAxLCBjb20gfSA9IHBsYXllcnM7XG4gIGNvbnN0IGNvbUF0dGFjayA9IGF3YWl0IGJvdExvZ2ljLmF1dG9BdHRhY2soY29tKTtcblxuICBjb20ubWFrZU1vdmUoY29tQXR0YWNrLCBwMS5ib2FyZCk7XG4gIGRvbS51cGRhdGVCb2FyZChwMSk7XG5cbiAgY29uc3Qgd2luU3RhdGUgPSBjaGVja0dhbWVTdGF0ZShwMSk7XG4gIGlmICh3aW5TdGF0ZSkge1xuICAgIGVuZEdhbWUoY29tKTtcbiAgfSBlbHNlIHtcbiAgICBkb20uZGlzYWJsZUV2ZW50cyhmYWxzZSwgJ2NvbScpO1xuICAgIGRvbS5nYW1lTWVzc2FnZSgncDFUdXJuJyk7XG4gIH1cbn07XG5cbmNvbnN0IHJlY2VpdmVQbGF5ZXJNb3ZlID0gKGNvb3JkKSA9PiB7XG4gIGNvbnN0IHsgcDEsIGNvbSB9ID0gcGxheWVycztcbiAgaWYgKGhlbHBlcnMuYWxyZWFkeVBsYXllZChwMSwgY29vcmQpKSByZXR1cm47XG4gIHAxLm1ha2VNb3ZlKGNvb3JkLCBjb20uYm9hcmQpO1xuICBkb20udXBkYXRlQm9hcmQoY29tKTtcblxuICBjb25zdCB3aW5TdGF0ZSA9IGNoZWNrR2FtZVN0YXRlKGNvbSk7XG4gIGlmICh3aW5TdGF0ZSkge1xuICAgIGVuZEdhbWUocDEpO1xuICB9IGVsc2Uge1xuICAgIHBsYXlDb21Nb3ZlKHAxLCBjb20pO1xuICAgIGRvbS5nYW1lTWVzc2FnZSgnY29tVHVybicpO1xuICB9XG4gIGRvbS5kaXNhYmxlRXZlbnRzKHRydWUsICdjb20nKTtcbn07XG5cbmNvbnN0IGdldFNoaXBzUGxhY2VkID0gKCkgPT4gcGxheWVycy5wMS5ib2FyZC5zaGlwcy5sZW5ndGg7XG5cbmNvbnN0IHBsYWNlU2hpcCA9IChlKSA9PiB7XG4gIGNvbnN0IHsgcDEgfSA9IHBsYXllcnM7XG4gIGNvbnN0IHNoaXBzUGxhY2VkU3RhcnQgPSBnZXRTaGlwc1BsYWNlZCgpO1xuXG4gIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2JvYXJkJykgfHwgc2hpcHNQbGFjZWRTdGFydCA+PSA1KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgc3RhcnRJbmRleCA9IGhlbHBlcnMuZ2V0Q2VsbEluZm8oZS50YXJnZXQpO1xuICBjb25zdCBuZXh0U2hpcCA9IGhlbHBlcnMubmV4dFNoaXBMZW5ndGgoc2hpcHNQbGFjZWRTdGFydCk7XG4gIGNvbnN0IGF4aXMgPSBzaGlwQnVpbGRlci5nZXRBeGlzKCk7XG4gIGNvbnN0IHNoaXBWYWxpZCA9IHNoaXBCdWlsZGVyLmlzU2hpcFZhbGlkKHAxLCBzdGFydEluZGV4LCBheGlzLCBuZXh0U2hpcCk7XG5cbiAgaWYgKHNoaXBWYWxpZCkge1xuICAgIHAxLmJvYXJkLnBsYWNlU2hpcChuZXh0U2hpcCwgc3RhcnRJbmRleCwgYXhpcyk7XG4gICAgc2hpcEJ1aWxkZXIuY2xlYXJQcmV2aWV3KCk7XG4gICAgZG9tLnJlbmRlclNoaXBzKHAxKTtcblxuICAgIGNvbnN0IHNoaXBzUGxhY2VkRW5kID0gZ2V0U2hpcHNQbGFjZWQoKTtcbiAgICBkb20ucmVhZHlHYW1lKHNoaXBzUGxhY2VkRW5kKTtcbiAgfVxufTtcblxuY29uc3QgdW5kb1NoaXAgPSAoKSA9PiB7XG4gIGNvbnN0IHsgcDEgfSA9IHBsYXllcnM7XG4gIGlmIChwMS5ib2FyZC5zaGlwcy5sZW5ndGggPT09IDApIHJldHVybjtcbiAgcDEuYm9hcmQucmVtb3ZlTGFzdFNoaXAoKTtcblxuICBkb20uY2xlYXJVSShwMSk7XG4gIGRvbS5yZW5kZXJTaGlwcyhwMSk7XG4gIGRvbS5yZWFkeUdhbWUoZ2V0U2hpcHNQbGFjZWQoKSk7XG59O1xuXG5jb25zdCBhdXRvUGxhY2VQbGF5ZXIgPSAoKSA9PiB7XG4gIGNvbnN0IHsgcDEgfSA9IHBsYXllcnM7XG4gIGNvbnN0IHNoaXBzUGxhY2VkID0gZ2V0U2hpcHNQbGFjZWQoKTtcblxuICBib3RMb2dpYy5hdXRvUGxhY2UocDEsIHNoaXBzUGxhY2VkKTtcbiAgZG9tLnJlbmRlclNoaXBzKHAxKTtcbiAgZG9tLnJlYWR5R2FtZShnZXRTaGlwc1BsYWNlZCgpKTtcblxuICBpZiAoc2hpcHNQbGFjZWQgPT09IDUpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDU7IGkrKykge1xuICAgICAgdW5kb1NoaXAoKTtcbiAgICB9XG4gICAgYXV0b1BsYWNlUGxheWVyKCk7XG4gIH1cbn07XG5cbmV4cG9ydCB7XG4gIG5ld0dhbWUsXG4gIHN0YXJ0R2FtZSxcbiAgcmVjZWl2ZVBsYXllck1vdmUsXG4gIHBsYWNlU2hpcCxcbiAgZ2V0U2hpcHNQbGFjZWQsXG4gIGF1dG9QbGFjZVBsYXllcixcbiAgdW5kb1NoaXAsXG59O1xuIiwiaW1wb3J0ICcuL3N0eWxlLmNzcyc7XG5pbXBvcnQgKiBhcyBnYW1lIGZyb20gJy4vbW9kdWxlcy9nYW1lJztcbmltcG9ydCAqIGFzIGRvbSBmcm9tICcuL21vZHVsZXMvZG9tJztcbmltcG9ydCAqIGFzIGV2ZW50Q29udHJvbGxlciBmcm9tICcuL21vZHVsZXMvZXZlbnRDb250cm9sbGVyJztcblxuZG9tLmNyZWF0ZUJvYXJkcygpO1xuZ2FtZS5uZXdHYW1lKCk7XG5cbmV2ZW50Q29udHJvbGxlci5pbml0Qm9hcmRFdmVudHMoKTtcbmV2ZW50Q29udHJvbGxlci5pbml0R2FtZUJ1dHRvbnMoKTtcbmV2ZW50Q29udHJvbGxlci5pbml0U2hpcFBsYWNlbWVudCgpO1xuIiwiaW1wb3J0ICogYXMgZ2FtZSBmcm9tICcuL2dhbWUnO1xuaW1wb3J0ICogYXMgaGVscGVycyBmcm9tICcuL2hlbHBlcnMnO1xuaW1wb3J0ICogYXMgc2hpcEJ1aWxkZXIgZnJvbSAnLi9zaGlwQnVpbGRlcic7XG5cbmNvbnN0IGluaXRCb2FyZEV2ZW50cyA9ICgpID0+IHtcbiAgY29uc3QgY29tQ2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjY29tLWJvYXJkIC5ib2FyZC1jZWxsJyk7XG4gIGNvbUNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgIGNvbnN0IGNvb3JkID0gaGVscGVycy5nZXRDZWxsSW5mbyhlLnRhcmdldCk7XG4gICAgICBnYW1lLnJlY2VpdmVQbGF5ZXJNb3ZlKGNvb3JkKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5jb25zdCBpbml0R2FtZUJ1dHRvbnMgPSAoKSA9PiB7XG4gIGNvbnN0IHJlc3RhcnRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcmVzdGFydC1idG4nKTtcbiAgcmVzdGFydEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGdhbWUubmV3R2FtZSk7XG5cbiAgY29uc3Qgc3RhcnRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc3RhcnQtYnRuJyk7XG4gIHN0YXJ0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZ2FtZS5zdGFydEdhbWUpO1xuXG4gIGNvbnN0IGF1dG9CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjYXV0by1zaGlwJyk7XG4gIGF1dG9CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBnYW1lLmF1dG9QbGFjZVBsYXllcik7XG5cbiAgY29uc3Qgcm90YXRlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3JvdGF0ZScpO1xuICByb3RhdGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzaGlwQnVpbGRlci5zd2l0Y2hBeGlzKTtcblxuICBjb25zdCB1bmRvQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3VuZG8tc2hpcCcpO1xuICB1bmRvQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZ2FtZS51bmRvU2hpcCk7XG5cbiAgY29uc3QgcmVzZXRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcmVzZXQtc2hpcCcpO1xuICByZXNldEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGdhbWUubmV3R2FtZSk7XG59O1xuXG5jb25zdCBpbml0U2hpcFBsYWNlbWVudCA9ICgpID0+IHtcbiAgY29uc3QgcGxheWVyQm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcGxheWVyLWJvYXJkJyk7XG4gIHBsYXllckJvYXJkLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIChlKSA9PiB7XG4gICAgY29uc3Qgc2hpcHNQbGFjZWQgPSBnYW1lLmdldFNoaXBzUGxhY2VkKCk7XG4gICAgY29uc3QgbmV4dFNoaXAgPSBoZWxwZXJzLm5leHRTaGlwTGVuZ3RoKHNoaXBzUGxhY2VkKTtcbiAgICBzaGlwQnVpbGRlci5wcmV2aWV3U2hpcChlLCBuZXh0U2hpcCk7XG4gIH0pO1xuICBwbGF5ZXJCb2FyZC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW91dCcsIHNoaXBCdWlsZGVyLmNsZWFyUHJldmlldyk7XG4gIHBsYXllckJvYXJkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZ2FtZS5wbGFjZVNoaXApO1xufTtcblxuZXhwb3J0IHsgaW5pdEJvYXJkRXZlbnRzLCBpbml0R2FtZUJ1dHRvbnMsIGluaXRTaGlwUGxhY2VtZW50IH07XG4iXSwibmFtZXMiOlsicGxheWVyRmFjdG9yeSIsIm51bSIsImh1bWFuIiwiZ2FtZWJvYXJkIiwidGlsZXMiLCJBcnJheSIsImkiLCJqIiwiaGl0Iiwic2hpcElkIiwiY3JlYXRlQm9hcmQiLCJzaGlwcyIsImhhc1NoaXAiLCJ4IiwieSIsInNoaXBzUmVtYWluaW5nIiwiZmlsdGVyIiwic2hpcCIsImlzU3VuayIsImxlbmd0aCIsInBsYWNlU2hpcCIsImF4aXMiLCJpZCIsInNvbWUiLCJtYXBTaGlwSWQiLCJuZXdTaGlwIiwiaGVhbHRoIiwia2V5cyIsInJlZHVjZSIsInByZXYiLCJjdXJyIiwiY29vcmRzIiwiaW5kZXgiLCJPYmplY3QiLCJ2YWx1ZXMiLCJldmVyeSIsInNoaXBGYWN0b3J5IiwicHVzaCIsInJlY2VpdmVBdHRhY2siLCJ0YXJnZXQiLCJ0aGlzVGlsZSIsInRoaXNTaGlwIiwiZmluZFNoaXAiLCJ2YWx1ZSIsImFsbFNoaXBzU3VuayIsInJlbW92ZUxhc3RTaGlwIiwic3BsaWNlIiwiZ2FtZWJvYXJkRmFjdG9yeSIsIm1vdmVzIiwiYm9hcmQiLCJpc0h1bWFuIiwibWFrZU1vdmUiLCJlbmVteUJvYXJkIiwiZ2FtZWJvYXJkcyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsInBsYXllckJvYXJkIiwicXVlcnlTZWxlY3RvciIsImNvbUJvYXJkIiwiZ2FtZUluZm8iLCJ1cGRhdGVTaGlwQ291bnQiLCJwbGF5ZXIiLCJzaGlwQ291bnRlciIsInByZXZpb3VzRWxlbWVudFNpYmxpbmciLCJ0ZXh0Q29udGVudCIsImhpZGVTaGlwQ291bnQiLCJib29sIiwic2hpcENvdW50ZXJzIiwiZm9yRWFjaCIsImVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJyZW5kZXJTaGlwcyIsImtleSIsInRoaXNDZWxsIiwiZGF0YXNldCIsInVwZGF0ZUJvYXJkIiwidGhpc0JvYXJkIiwic3R5bGVHYW1lT3ZlciIsImNsZWFyVUkiLCJwbGF5ZXJzIiwiY2VsbCIsInJlbW92ZUF0dHJpYnV0ZSIsImdhbWVNZXNzYWdlIiwic3RhdGUiLCJudW1TaGlwcyIsIm1lc3NhZ2VzIiwic2V0dXAiLCJyZWFkeSIsInAxVHVybiIsImNvbVR1cm4iLCJkaXNhYmxlRXZlbnRzIiwidG9nZ2xlU3RhcnQiLCJzdGFydEJ0biIsInNldEF0dHJpYnV0ZSIsInJlYWR5R2FtZSIsImRpc2FibGVCb2FyZEZ1bmNzIiwiYm9hcmRGdW5jcyIsImJ1dHRvbkNvbnRhaW5lciIsImJ1dHRvbiIsImdldENlbGxJbmZvIiwiTnVtYmVyIiwiYWxyZWFkeVBsYXllZCIsInByZXZpb3VzTW92ZXMiLCJnZXRSYW5kb21UaWxlIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiZ2V0UmFuZG9tRW1wdHkiLCJlbXB0eVRpbGVzIiwiY29vcmQiLCJnZXRFbXB0eVRpbGVzIiwibmV4dFNoaXBMZW5ndGgiLCJudW1TaGlwc1BsYWNlZCIsImF4ZXMiLCJnZXRBeGlzIiwic3dpdGNoQXhpcyIsImJ1aWxkU2hpcCIsInN0YXJ0Iiwic2hpcENvb3JkcyIsImRvZXNTaGlwRml0Iiwic3RhcnRJbmRleCIsIm5vT3ZlcmxhcCIsImNsZWFyUHJldmlldyIsImdldFZhbGlkU3RhcnQiLCJzaGlwRml0cyIsInJhbmRvbUluZGV4IiwicmFuZG9tQXhpcyIsInJhbmRvbVNoaXAiLCJ2YWxpZCIsImF1dG9QbGFjZSIsInNoaXBzU29GYXIiLCJwMSIsImNvbSIsImNoZWNrR2FtZVN0YXRlIiwibmV3R2FtZSIsInN0YXJ0R2FtZSIsImVuZEdhbWUiLCJ3aW5uZXIiLCJ3aW5NZXNzYWdlIiwicmVjZWl2ZVBsYXllck1vdmUiLCJhc3luYyIsImNvbUF0dGFjayIsInJhbmRvbU1vdmUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJwbGF5Q29tTW92ZSIsImdldFNoaXBzUGxhY2VkIiwiZSIsInNoaXBzUGxhY2VkU3RhcnQiLCJjb250YWlucyIsIm5leHRTaGlwIiwic2hpcFZhbGlkIiwic2hpcHNQbGFjZWRFbmQiLCJ1bmRvU2hpcCIsImF1dG9QbGFjZVBsYXllciIsInNoaXBzUGxhY2VkIiwiYm9hcmRDZWxsIiwiY3JlYXRlRWxlbWVudCIsImFwcGVuZENoaWxkIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm5leHRDZWxsIiwiYnVpbGRQcmV2aWV3IiwidmFsaWRQcmV2aWV3IiwiaXNXaXRoaW5Cb3VuZHMiLCJub090aGVyU2hpcHMiLCJpc1ByZXZpZXdWYWxpZCJdLCJzb3VyY2VSb290IjoiIn0=